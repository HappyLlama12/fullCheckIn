<!--
Club Check-In Page

INSTRUCTIONS:
1) Replace the two CONFIG values below:

-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hillel Check-In</title>
  <style>
    @font-face {
      font-family: 'Neue Montreal';
      src: url('./fonts/NeueMontreal-Regular.otf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
  
    @font-face {
      font-family: 'Gilroy';
      src: url('./fonts/Gilroy-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Gilroy Bold';
      src: url('./fonts/Gilroy-Bold.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    :root{--bg:#f6f6f8;--card:#ffffff;--accent:rgb(5,49,154);--muted:#666}
    html,body{height:100%;margin:0;}
    /* Entire page uses Gilroy */
    body {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      background-image: url('hillel.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      z-index: 0;
      font-family: 'Gilroy', system-ui, sans-serif;
    }
    /* Only h1 uses Neue Montreal */
    h1 {
      margin: 0 0 0;             /* Remove bottom margin */
      margin-bottom: 12px;       /* more space below heading */
      font-family: 'Neue Montreal', system-ui, sans-serif;
      font-weight: 700;
      font-style: normal;
      font-size: 48px;           /* Desktop font size */
      line-height: 1em;
      letter-spacing: -0.5px;
      color: rgb(5, 49, 154);    /* Optional: add this if you want the blue color */
    }
    @media (max-width: 1023px) {
      h1 {
        font-size: 44px;
      }
    }
    body::before {
      content: "";
      position: fixed;  /* or absolute */
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.4); /* black with 40% opacity */
      pointer-events: none;  /* lets clicks pass through */
      z-index: 1;
    }
    .card{position: relative; z-index:2; width:360px;max-width:92vw;background:var(--card);padding:18px 18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.08);text-align:center}
    input[type=text],input[type=tel],input[type=email],input[type=date]{width:100%;padding:16px 10px;font-size:17px;margin-bottom:10px;border-radius:5px;border:none; background-color: rgb(230,230,230); box-sizing:border-box; font-family: Gilroy, Arial, Helvetica, sans-serif; color: rgb(52,58,64);}
    input[type=text]:focus, input[type=email]:focus,input[type=tel]:focus,input[type=date]:focus,select:focus{
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 5px var(--accent);
    }
    /*input[type=text]::placeholder {
      font-weight: normal;
      font-family: Gilroy, Arial, Helvetica, sans-serif;
      font-size: 17px;
      color: rgb(52, 58, 64) !important;
    }
      */
    button.action{width: 100%;height: 48px; background-color: rgb(5,49,154); color: white; border: none; border-radius: 5px; padding: 12px 18px; font-family: 'Gilroy Bold', system-ui, sans-serif;font-size: 18px; cursor: pointer; letter-spacing: 0px; text-align: center; line-height: 1.2;}
    .outlined-btn{background: #d3d3d3; border: 3px #363636;color: #363636;border-radius: 6px;padding: 6px 12px;cursor: pointer;margin: 4px;font-size: 14px;}
    #status{margin-top:10px;font-weight:600; color: #b00020}
    .footer{margin-top:12px;font-size:12px;color:var(--muted);font-weight: 600}
    .danger{color:#b00020}
    .row{display:flex;gap:8px}
    .remember-text {
      font-family: Gilroy, Arial, Helvetica, sans-serif;
      color: rgb(52, 58, 64);
      font-weight: 500;  /* normal weight */
      font-size: 17px;
      margin-left: 8px;
      user-select: none; /* optional, if you want to prevent text selection */
      vertical-align: middle; /* to align with the toggle nicely */
    }
      #eraseLink {
        margin-top: 16px;
        font-size: 12px;
        color: rgb(52,58,64);
      }
      #welcomeMessage{
        margin-top: 20px;
        font-weight: 600;
        font-size: 18px;
        color: green;
      }

      #welcomeMessage.status-auto {
        color: #0b5cff; /* blue */
      }

      #welcomeMessage.status-success {
        color: green;
      }
      select {
        width: 100%;
        padding: 18px 45px 18px 14px; /* top right bottom left*/
        margin-bottom: 12px;
        font-size: 17px;
        border-radius: 5px;
        border: none;
        background-color: rgb(230, 230, 230);
        font-family: Gilroy, Arial, Helvetica, sans-serif;
        box-sizing: border-box;
        color: rgb(52,58,64);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;

        background-image: url('data:image/svg+xml;utf8,<svg fill="dark gray" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 20px;
      }
      /*input[type=date] {
        font-family: 'Gilroy', system-ui, sans-serif;
        color: rgb(52,58,64);
      }
      */
      input::placeholder {
        color:#808080 !important;
        font-weight: normal;
        font-family: 'Gilroy', Arial, Helvetica, sans-serif;
        font-size: 17px;
      }
</style>
</head>
<body>
  <div class="card" role="main">
    <h1>Hillel Checkâ€‘In</h1>

    <div id="inputSection">
      <label for="fullName">Full Name</label>
      <input type="text" id="fullName" placeholder="Enter your name" />

      <label for="phone">Telephone Number</label>
      <input type="tel" id="phone" placeholder="Enter your phone number (optional)" />

      <label for="email">Email Address</label>
      <input type="email" id="email" placeholder="Enter your email address" />

      <label for="birthday">Birth Date</label>
      <input type="date" id="birthday" />

      <label for="faculty">Faculty</label>
      <select id="faculty">
        <option value="" disabled selected>Select Faculty</option>
        <option value="Faculty of Arts and Science">Faculty of Arts and Science</option>
        <option value="Faculty of Education">Faculty of Education</option>
        <option value="Faculty of Health Sciences">Faculty of Health Sciences</option>
        <option value="Faculty of Law">Faculty of Law</option>
        <option value="School of Graduate Studies and Postdoctoral Affairs">School of Graduate Studies and Postdoctoral Affairs</option>
        <option value="MD Program">MD Program</option>
        <option value="School of Nursing">School of Nursing</option>
        <option value="Smith Engineering">Smith Engineering</option>
        <option value="Smith School of Business">Smith School of Business</option>
        <option value="Bader College">Bader College</option>
      </select>

      <button id="submitBtn" class="action">Check In</button>

      <div style="margin-top:14px; text-align:left; display: flex; align-items: center;">
        <label class="switch">
          <input type="checkbox" id="rememberToggle" checked>
          <span class="slider"></span>
        </label>
        <span class="remember-text">Remember my name for next time</span>
      </div>
    </div>

    <div id="welcomeMessage" style="display:none;"></div>

    <style>
.switch {
  position: relative;
  display: inline-block;
  width: 46px;
  height: 24px;
  vertical-align: middle;
}

.switch input {display:none;}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: .3s;
  border-radius: 24px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .3s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--accent);
}

input:checked + .slider:before {
  transform: translateX(22px);
}

#inputSection {
  max-width: 400px; /* optional: keeps form neat */
}

#inputSection label {
  display: block;
  margin-left: 2px;
  margin-bottom: 2px;
  font-weight: bold;
  text-align: left; /* ensures left alignment */
  color: rgb(52,58,64)
}

</style>

    <div id="eraseLink">
      If your name is currently saved and you want it to be erased click 
      <a href="#" id="eraseNow">here</a>.
    </div>

    <div id="status"></div>
  </div>

  <!-- hidden iframe used to submit the Google Form so the page doesn't navigate -->
  <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>


   <!--<form action="https://docs.google.com/forms/d/e/1FAIpQLSe6WCyUZUTdwGfrdI4o7sS9rYbmhnH-ysystS9rDprSf5zSwA/formResponse" method="POST" target="_blank">
  <input name="entryl1262182397" value="Test User">
  <button type="submit">Test Submit</button>
</form> -->
   
  <script>
    // ===== CONFIG =====
    const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSe6WCyUZUTdwGfrdI4o7sS9rYbmhnH-ysystS9rDprSf5zSwA/formResponse";
    const ENTRY_FOR_NAME = "entry.1262182397";
    const ENTRY_FOR_PHONE = "entry.600998077";
    const ENTRY_FOR_EMAIL = "entry.1950836464";
    const ENTRY_FOR_BIRTHDAY = "entry.1103099865";
    const ENTRY_FOR_FACULTY = "entry.2128704692";
    // ==================

    const submitBtn = document.getElementById('submitBtn');
    const status = document.getElementById('status');
    const nameInput = document.getElementById('fullName');
    const rememberToggle = document.getElementById('rememberToggle');
    const inputSection = document.getElementById('inputSection');
    const welcomeMessage = document.getElementById('welcomeMessage');

    function showWelcomeMessage(name, isAuto=false) {
      const welcomeText = isAuto
        ? `Welcome back ${name}, you are checked in!`
        :(rememberToggle.checked
          ? `Welcome ${name}, you are checked in!<br>Your name will be remembered for next time on this device.`
          : `Welcome ${name}, you are checked in!`);

      welcomeMessage.innerHTML = welcomeText;
      welcomeMessage.style.display = 'block';
      inputSection.style.display = 'none';

      welcomeMessage.classList.remove('status-auto', 'status-success');
      if (isAuto) {
        welcomeMessage.classList.add('status-auto');
      } else {
        welcomeMessage.classList.add('status-success');  // green for normal
      }
    }

    function hideWelcomeMessage() {
      welcomeMessage.style.display = 'none';
      inputSection.style.display = 'block';
    }

    function handleSubmit(){
      const name = nameInput.value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const birthday = document.getElementById('birthday').value;
      const faculty = document.getElementById('faculty').value;

      //clear any previous error
      status.textContent = '';
      welcomeMessage.style.display = 'none';

      //validate name
       if (!name) {
          status.textContent = 'Please enter your full name.';
          welcomeMessage.style.display = 'none';
          return;
      }

      //validate phone (simple regex for 10 digits)
      // Phone validation: only if not empty
      if (phone) {
        // Remove everything except digits
        const phoneDigits = phone.replace(/\D/g, "");

        if (phoneDigits.length !== 10) {
        alert("Please enter a valid phone number with 10 digits, or leave it blank.");
        return;
        }
      }

      // Validate Email (simple email regex)
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        status.textContent = 'Please enter a valid email address.';
        return;
      }

      // Validate Birthday (ensure not empty)
      if (!birthday) {
        status.textContent = 'Please enter your birthday.';
        return;
      }

      // Validate Faculty (ensure selected)
      if (!faculty) {
        status.textContent = 'Please select your faculty.';
        return;
      }

      //save only name to local storage for if toggle is checked
      if (rememberToggle.checked) {
        localStorage.setItem("clubName", name);
        localStorage.setItem("clubPhone", phone);
        localStorage.setItem("clubEmail", email);
        localStorage.setItem("clubBirthday", birthday);
        localStorage.setItem("clubFaculty", faculty);
      }
      
      //submit all data
      submitGoogle({name, phone, email, birthday, faculty});

      showWelcomeMessage(name,false);

      /*if (rememberToggle.checked){
        status.innerHTML = `Welcome ${name}, you are checked in!<br>Your name will be remembered for next time on this device.`;
      } else {
        status.textContent = `Welcome ${name}, you are checked in!`;
      }*/
      
      setTimeout(() => {clearDisplay(); status.textContent = ''; }, 5000);
    }

    function clearDisplay() {
      nameInput.value = '';
      status.textContent = '';
      status.classList.remove("status-auto");
    }

    function submitGoogle(data){
       
      // build a form and submit it to the Google Form response endpoint inside the hidden iframe
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = FORM_ACTION;
      form.target = 'hidden_iframe';

      console.log("Submitting data to Google:", data);

      const fields = {
        [ENTRY_FOR_NAME]: data.name,
        [ENTRY_FOR_PHONE]: data.phone,
        [ENTRY_FOR_EMAIL]: data.email,
        [ENTRY_FOR_BIRTHDAY]: data.birthday,
        [ENTRY_FOR_FACULTY]: data.faculty,
      };

      for (const [key, value] of Object.entries(fields)) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = key;
        input.value = value;
        form.appendChild(input);
      }

      // append & submit
      document.body.appendChild(form);
      form.submit();

      // cleanup after a short delay
      setTimeout(()=>{ try{ document.body.removeChild(form);}catch(e){} }, 1500);
    }

    document.getElementById('eraseNow').addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem("clubName");
      localStorage.removeItem("clubPhone");
      localStorage.removeItem("clubEmail");
      localStorage.removeItem("clubBirthday");
      localStorage.removeItem("clubFaculty");

      nameInput.value = '';
      document.getElementById('phone').value = '';
      document.getElementById('email').value = '';
      document.getElementById('birthday').value = '';
      document.getElementById('faculty').value = '';
      
      status.textContent = 'Your saved profile has been removed.';
      hideWelcomeMessage();
      setTimeout(() => { status.textContent = ''; }, 5000);
    });
    
    
    submitBtn.addEventListener('click', handleSubmit);

    nameInput.addEventListener('keydown', (event) => {
      if (event.key === "Enter") {
        event.preventDefault(); // Prevent form submission if inside a form
        handleSubmit();
      }
    });

    /*
    clearBtn.addEventListener('click', () => {
      clearDisplay();
    }); */

    // ORRRRRR clearBtn.addEventListener('click', clearDisplay);

    // on load: if saved, auto-submit
    window.addEventListener("load", () => {
      const savedName = localStorage.getItem("clubName");
      const savedPhone = localStorage.getItem("clubPhone") || "";
      const savedEmail = localStorage.getItem("clubEmail");
      const savedBirthday = localStorage.getItem("clubBirthday");
      const savedFaculty = localStorage.getItem("clubFaculty");

      if (savedName) {
        status.classList.add("status-auto");
        status.classList.remove("status-success");
    
        nameInput.value = savedName; //keep filled for quick check-in
        document.getElementById('phone').value = savedPhone;
        document.getElementById('email').value = savedEmail;
        document.getElementById('birthday').value = savedBirthday;
        document.getElementById('faculty').value = savedFaculty;

        rememberToggle.checked = true;
        showWelcomeMessage(savedName, true);

        submitGoogle({name:savedName,phone:savedPhone,email:savedEmail,birthday:savedBirthday,faculty:savedFaculty});

        setTimeout(() => {clearDisplay(); status.textContent = ""; status.classList.remove("status-auto"); }, 5000);
      } else {
        rememberToggle.checked = true;
        hideWelcomeMessage();
      }
    });

  </script>
</body>
</html>
